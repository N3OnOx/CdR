<h2 class="page-header">Construir</h2>
<ul class="list-group">
    <a href="#">
        <li onclick="make({{tiempo}})" class="list-group-item"></li>
    </a>

    <button onclick="updateResource('{{familyId}}', 'silver', 25)">Silver</button>
    <button id="make" onclick="make({{tiempo}}, '{{familyId}}', 'smithy')">Foundry <span id="time"></span></button>
    <div id="respuesta"></div>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <div><span id="image_coords_click"></span><span id="image_coords_now"> </span></div>
    <img id="image" src="/images/mapa.png" width="500" height="500">
    <script type="text/javascript">
        $('#image').mousemove(function (event) {
            window.current_x = Math.round(event.pageX - $('#image').offset().left);
            window.current_y = Math.round(event.pageY - $('#image').offset().top);
            window.current_coords = window.current_x + ', ' + window.current_y;
            $('#image_coords_now').html('Current: ' + window.current_coords + '.');
        }).mouseleave(function () {
            $('#image_coords_now').html(' ');
        }).click(function () {
            $('#image_coords_click').html('Last click: ' + window.current_coords + '. ');
        });
    </script>

</ul>
<script>
    function getResources(id) {
        $.ajax({
            type: 'GET',
            url: `http://localhost:3000/resources/getResources/${id}`,
            success: function (data) {
                console.log('success');
            }
        });
    }

    function updateResource(id, resource, quantity) {
        $.ajax({
            type: 'PUT',
            url: `http://localhost:3000/families/actualizarRecurso/${id}/${resource}/${quantity}`,
            success: function (data) {
                console.log('success');
            }
        });
    }

    function updateConstruction(id, construction) {
        
        $("#make").fadeOut(0);
        $.ajax({
            type: 'PUT',
            url: `http://localhost:3000/constructions/updateConstruction/${id}/${construction}`,
            success: function (data) {
                console.log('success');
            },
            error: function (request, status, error) {
                console.log(request.responseText);
            }

        });
        console.log("nivel maximo")
    }
        
    }
</script>
<script>
    var seconds = {{ tiempo }};
    // Multiplicar por 1000 porque Date() trabaja con milisegundos
    var date = new Date(seconds * 1000);
    var hh = date.getUTCHours();
    var mm = date.getUTCMinutes();
    var ss = date.getSeconds();

    var dd = 0;
    dd = Math.trunc(seconds / 86400);
    console.log(dd);

    // Poner dos d√≠gitos
    if (dd < 10) { dd = "0" + dd; }
    if (hh < 10) { hh = "0" + hh; }
    if (mm < 10) { mm = "0" + mm; }
    if (ss < 10) { ss = "0" + ss; }
    // Formatear a HH:MM:SS
    var t = dd + ":" + hh + ":" + mm + ":" + ss;
    document.getElementById("time").innerHTML = t;

    function make(tiempo, id, construction) {
        function startTimer(duration, display) {
            var timer = duration, minutes, seconds;
            intervalid = setInterval(function () {
                var date = new Date(timer * 1000);
                var hh = date.getUTCHours();
                var mm = date.getUTCMinutes();
                var ss = date.getSeconds();
                var dd = Math.trunc(timer / 86400);
                console.log(dd);


                if (dd < 10) { dd = "0" + dd; }
                if (hh < 10) { hh = "0" + hh; }
                if (mm < 10) { mm = "0" + mm; }
                if (ss < 10) { ss = "0" + ss; }
                // This formats your string to HH:MM:SS
                var t = dd + ":" + hh + ":" + mm + ":" + ss;

                display.textContent = t;
                if (--timer < 0) {
                    clearInterval(intervalid);
                    $("#time").fadeOut(0);
                    console.log(id);
                    console.log(construction);
                    updateConstruction(id, construction);
                }
            }, 1000);
        }

        display = document.querySelector('#time');
        startTimer(tiempo, display);

    }
</script>